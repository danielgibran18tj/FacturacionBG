<div class="card shadow-sm border-0">
  <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center">
    <h5 class="m-0 fw-bold">
      <i class="bi bi-receipt"></i> Facturas
    </h5>

    <button class="btn btn-primary btn-sm" style="background:#d4145a; border-color:#d4145a;">
      <i class="bi bi-file-plus"></i> Nueva Factura
    </button>
  </div>

  <div class="card-body">

    <!-- Búsqueda -->
    <div class="input-group mb-3">
      <span class="input-group-text bg-light"><i class="bi bi-search"></i></span>
      <input [(ngModel)]="searchTerm" class="form-control" placeholder="Buscar factura..."
        (keyup.enter)="loadInvoices()">
      <button class="btn btn-outline-primary" (click)="loadInvoices()">Buscar</button>
    </div>

    <!-- === FILTROS AVANZADOS === -->
    <div class="card p-3 mb-3">
      <div class="row g-3">
        <div class="col-md-3">
          <label class="form-label fw-bold">Fecha inicio</label>
          <input type="date" class="form-control" [(ngModel)]="startDate">
        </div>

        <div class="col-md-3">
          <label class="form-label fw-bold">Fecha fin</label>
          <input type="date" class="form-control" [(ngModel)]="endDate">
        </div>

        <div class="col-md-3">
          <label class="form-label fw-bold">Monto mínimo</label>
          <input type="number" class="form-control" [(ngModel)]="minAmount">
        </div>

        <div class="col-md-3">
          <label class="form-label fw-bold">Monto máximo</label>
          <input type="number" class="form-control" [(ngModel)]="maxAmount">
        </div>
      </div>
      <div class="mt-3 d-flex gap-2">
        <button class="btn btn-primary" (click)="applyFilters()">
          <i class="bi bi-filter"></i> Aplicar filtros
        </button>
        <button class="btn btn-outline-secondary" (click)="clearFilters()">
          <i class="bi bi-x-circle"></i> Limpiar
        </button>
      </div>
    </div>

    <!-- Tabla -->
    <div class="table-responsive">
      <table class="table table-hover align-middle">
        <thead class="table-light">
          <tr>
            <th>#</th>
            <th>Fecha</th>
            <th>Cliente</th>
            <th>Vendedor</th>
            <th>Estado</th>
            <th>Total</th>
            <th class="text-center">Acciones</th>
          </tr>
        </thead>

        <tbody>
          <tr *ngFor="let f of invoices">
            <td>{{ f.invoiceNumber }}</td>
            <td>{{ f.invoiceDate | date:'dd/MM/yyyy' }}</td>
            <td>{{ f.customerName }}</td>
            <td>{{ f.sellerName }}</td>
            <td>
              <span class="badge bg-success" *ngIf="f.status === 'Active'">Pagada</span>
              <span class="badge bg-warning text-dark" *ngIf="f.status !== 'Active'">Pendiente</span>
            </td>
            <td>{{ f.total | number:'1.2-2' }}</td>

            <td class="text-center">
              <button class="btn btn-sm btn-secondary mb-1 me-1" (click)="openDetails(f)">
                <i class="bi bi-pencil"> Detalles</i>
              </button>
              <button class="btn btn-sm btn-info mb-1 me-1 text-white" (click)="downloadPdf(f.id)">
                <i class="bi bi-file-earmark-pdf"> PDF </i>
              </button>
              <button class="btn btn-danger mb-1 btn-sm" (click)="openDelete(f)">
                <i class="bi bi-trash"> Eliminar</i>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Paginación -->
    <nav *ngIf="totalPages > 1">
      <ul class="pagination justify-content-center">

        <li class="page-item" [class.disabled]="page === 1">
          <button class="page-link" (click)="changePage(page - 1)">Anterior</button>
        </li>

        <li class="page-item" *ngFor="let p of [].constructor(totalPages); let i = index"
          [class.active]="page === (i + 1)">
          <button class="page-link" (click)="changePage(i + 1)">{{ i + 1 }}</button>
        </li>

        <li class="page-item" [class.disabled]="page === totalPages">
          <button class="page-link" (click)="changePage(page + 1)">Siguiente</button>
        </li>

      </ul>
    </nav>

  </div>

  <!-- Modal de detalles -->
  <app-invoice-details-modal *ngIf="selectedInvoice && showDetails" [invoice]="selectedInvoice"
    (close)="closeDetails()">
  </app-invoice-details-modal>

  <!-- Modal eliminar -->
  <app-delete-confirm-modal *ngIf="selectedInvoice && showDelete" [invoice]="selectedInvoice"
    (confirm)="deleteInvoice($event)" (close)="closeDelete()">
  </app-delete-confirm-modal>

</div>